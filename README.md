# Nervana User Api Server

This is a POC which shows how much of the boilerplate is autogenerated when building 
a client, controllers and a UAS server. It uses the apiserver-builder which generates much of the skeleton for a User Api Server

- Download the latest [release](https://github.com/kubernetes-incubator/apiserver-builder/releases)
- Extract to `/usr/local/apiserver-builder/`
- Add `/usr/local/apiserver-builder/bin` to your path
  `export PATH=$PATH:/usr/local/apiserver-builder/bin`
- Add cloud-testing/nuas to your path
  `export PATH=$PATH:/usr/local/apiserver-builder/bin`
- Test things are working by running `apiserver-boot -h`

Generating the APIServer skeletons for the 4 job types: batch, interact, streaming, training

- run `create`
- run `run`

Note - the Spec, Status types under pkg/apis/helium/v1 are empty when first created.
As they are filled in the regen command will not overlay them. The create command will copy pkg and sample to overlay the target empty types since the work here is filling out data type details.

Once the server is running you can create jobtypes
 
- run `kubectl --kubeconfig kubeconfig create -f sample/jobtype.yaml`
- run `kubectl --kubeconfig kubeconfig get jobtype -oyaml`

Debugging using delve

- Debugging tests
-- cd pkg/controller/jobtype
-- dlv test -test.run

- Debugging server
-- make run
-- dlv attach $(ps ax|grep bin/apiserver|grep -v grep|awk '{print $1}')
--- (dlv) b training_jobtype_types.go:86 
--- c
-- kubectl --kubeconfig=kubeconfig proxy
-- curl 127.0.0.1:8001/apis/helium.aipg.intel.com/v1/namespaces/default/jobtypes/jobtype-example2/training



